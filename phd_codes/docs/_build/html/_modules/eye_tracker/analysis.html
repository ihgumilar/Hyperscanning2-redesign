<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eye_tracker.analysis &mdash; Hyperscanning Experiments 1.0.0 Exp2-redesign documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Hyperscanning Experiments
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">phd_codes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Hyperscanning Experiments</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">eye_tracker.analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for eye_tracker.analysis</h1><div class="highlight"><pre>
<span></span><span class="c1"># ---</span>
<span class="c1"># jupyter:</span>
<span class="c1">#   jupytext:</span>
<span class="c1">#     cell_metadata_filter: -all</span>
<span class="c1">#     custom_cell_magics: kql</span>
<span class="c1">#     text_representation:</span>
<span class="c1">#       extension: .py</span>
<span class="c1">#       format_name: percent</span>
<span class="c1">#       format_version: &#39;1.3&#39;</span>
<span class="c1">#       jupytext_version: 1.11.2</span>
<span class="c1">#   kernelspec:</span>
<span class="c1">#     display_name: Python 3.8.10 (&#39;hyperscanning2_redesign_new&#39;)</span>
<span class="c1">#     language: python</span>
<span class="c1">#     name: python3</span>
<span class="c1"># ---</span>

<span class="c1"># %% [markdown]</span>
<span class="c1"># ## Relevant packages</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">atan</span><span class="p">,</span> <span class="n">degrees</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">matplotlib.cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">alive_progress</span> <span class="kn">import</span> <span class="n">alive_bar</span>
<span class="kn">from</span> <span class="nn">EEG.stats</span> <span class="kn">import</span> <span class="n">Connections</span>
<span class="c1"># add alpha (transparency) to a colormap (with background picture)</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>

<span class="c1"># %% [markdown]</span>
<span class="c1"># ## Low level module / class Degree</span>

<span class="c1"># %%</span>
<div class="viewcode-block" id="Degree"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.Degree">[docs]</a><span class="k">class</span> <span class="nc">Degree</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Low-level module</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">########################## Functions to convert to degree and check within fovea or not #################</span>

    <span class="c1"># Formula to convert cartesian to degree</span>
<div class="viewcode-block" id="Degree.gaze_direction_in_x_axis_degree"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.Degree.gaze_direction_in_x_axis_degree">[docs]</a>    <span class="k">def</span> <span class="nf">gaze_direction_in_x_axis_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Convert cartesian value to degree for gaze direction in X axis</span>
<span class="sd">                     Eye tracker data that is produced by HTC Vive pro is in cartesian</span>

<span class="sd">                     See &quot;Right hand rule coordinate&quot; for further information</span>

<span class="sd">        Parameters : - x (float or int) :  data in X axis</span>
<span class="sd">                     - y (float or int) :  data in Y axis</span>

<span class="sd">        Output      : - degree (float or int) : if it is float, then it has been rounded to 2 decimals</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span>  <span class="c1"># Opposite / adjacent</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Degree.gaze_direction_in_y_axis_degree"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.Degree.gaze_direction_in_y_axis_degree">[docs]</a>    <span class="k">def</span> <span class="nf">gaze_direction_in_y_axis_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Convert cartesian value to degree for gaze direction in Y axis</span>
<span class="sd">                     Eye tracker data that is produced by HTC Vive pro is in cartesian</span>

<span class="sd">                     See &quot;Right hand rule coordinate&quot; for further information</span>

<span class="sd">        Parameters : - y (float or int) :  data in Y axis</span>
<span class="sd">                     - z (float or int) :  data in Z axis</span>

<span class="sd">        Output      : - degree (float or int) : if it is float, then it has been rounded to 2 decimals</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">y</span><span class="p">))</span>  <span class="c1"># Opposite / adjacent</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Degree.check_degree_within_fovea"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.Degree.check_degree_within_fovea">[docs]</a>    <span class="k">def</span> <span class="nf">check_degree_within_fovea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gaze_direction</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective   : We need to check if the degree is within fovea or not, which indicates something is being looked.</span>
<span class="sd">                      In total 30 degrees where human can recognize an object. So we need to divide by 2 \n</span>
<span class="sd">                      Half right and half left</span>

<span class="sd">        Parameters  : gaze direction (float or int) : gaze direction which is in degree</span>
<span class="sd">                      If we refer to pandas dataframe, it is related to either one of these columns</span>

<span class="sd">                      - GazeDirectionRight(X)Degree</span>
<span class="sd">                      - GazeDirectionRight(Y)Degree</span>

<span class="sd">                      - GazeDirectionLeft(X)Degree</span>
<span class="sd">                      - GazeDirectionLeft(Y)Degree</span>

<span class="sd">        Output (int) :  1 = within the area of fovea (30 degrees) and</span>
<span class="sd">                        0 = NOT within area of fovea</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">gaze_direction</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gaze_direction</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">gaze_direction</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gaze_direction</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div></div>


<span class="c1"># %% [markdown]</span>
<span class="c1"># ## Low level module / class Looking</span>

<span class="c1"># %%</span>
<div class="viewcode-block" id="Looking"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.Looking">[docs]</a><span class="k">class</span> <span class="nc">Looking</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Low-level module</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Looking.looking_percentage"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.Looking.looking_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">looking_percentage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">odd_dataframe</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">even_dataframe</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">srate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">125</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Count how many times each pair &quot;really&quot; looks at each other throughout the experiment</span>
<span class="sd">                    This will look at per second.  &quot;Really&quot; is determined by a previous research which indicates</span>
<span class="sd">                    that humans are conscious look at each other within 100ms,</span>
<span class="sd">                    which is equal to there are 13 times of &quot;looking&quot; value within column of FoveaOdd or FoveaEven</span>

<span class="sd">        Parameters : - odd_dataframe (pandas dataframe) :  dataframe of odd participant</span>
<span class="sd">                    - even_dataframe (pandas dataframe) :  dataframe of even participant</span>
<span class="sd">                    - srate (int) : which indicates the step / per second that we will check whether</span>
<span class="sd">                                    the pair looking or not</span>
<span class="sd">                    - threshold (int) : threshold to determine whether the pair &quot;really&quot; looks or not</span>
<span class="sd">                                        if there are at least 13 times of &quot;looking&quot; within a second (srate)</span>
<span class="sd">                                        under the column of FoveaOdd or FoveaEven, then it is considered &quot;really&quot; looking</span>
<span class="sd">                        Note : Kindly refer to this research to see the threshold of 30 (100ms)</span>
<span class="sd">                        https://journals.sagepub.com/doi/abs/10.1111/j.1467-9280.2006.01750.x?casa_token=AYU81Dg2DAMAAAAA%3Asy9nVGA6NjQPFuRthQW5eCZl9V06TpqV2OgtYbUFPwVKCV4so2PlVJrBWo01EfiSX-yNHul7mX_DlYk&amp;journalCode=pssa</span>

<span class="sd">        Output      : - percent_look (float) : percentage of looking of a pair throughout the experiment</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">list_look</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># To chunk the data for every n raws (which indicate per second). Refer to srate</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">odd_dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">srate</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># To loop the series or data in a dataframe so that we can check if they are matched or not</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">srate</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">odd_dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;look&quot;</span>
                    <span class="ow">and</span> <span class="n">even_dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;look&quot;</span>
                <span class="p">):</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># each element of the list represents whether the pair looks at each other or not within a second</span>
            <span class="n">list_look</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Percentage of looking</span>
        <span class="n">percent_look</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">list_look</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_look</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="c1"># Get the last two digits only</span>
        <span class="n">percent_look</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">percent_look</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">percent_look</span></div></div>


<span class="c1"># %% [markdown]</span>
<span class="c1"># ## Abstract module / class</span>

<span class="c1"># %%</span>
<span class="k">class</span> <span class="nc">_IntermediaryEye</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract module</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">Degree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">looking</span> <span class="o">=</span> <span class="n">Looking</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Convert cartesian value to degree for gaze direction in X axis</span>
<span class="sd">                     Eye tracker data that is produced by HTC Vive pro is in cartesian</span>

<span class="sd">                     See &quot;Right hand rule coordinate&quot; for further information</span>

<span class="sd">        Parameters : - x (float or int) :  data in X axis</span>
<span class="sd">                     - y (float or int) :  data in Y axis</span>

<span class="sd">        Output      : - degree (float or int) : if it is float, then it has been rounded to 2 decimals</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="o">.</span><span class="n">gaze_direction_in_x_axis_degree</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">degree</span>

    <span class="k">def</span> <span class="nf">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Convert cartesian value to degree for gaze direction in Y axis</span>
<span class="sd">                     Eye tracker data that is produced by HTC Vive pro is in cartesian</span>

<span class="sd">                     See &quot;Right hand rule coordinate&quot; for further information</span>

<span class="sd">        Parameters : - y (float or int) :  data in Y axis</span>
<span class="sd">                     - z (float or int) :  data in Z axis</span>

<span class="sd">        Output      : - degree (float or int) : if it is float, then it has been rounded to 2 decimals</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="o">.</span><span class="n">gaze_direction_in_y_axis_degree</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">degree</span>

    <span class="k">def</span> <span class="nf">check_degree_within_fovea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gaze_direction</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective   : We need to check if the degree is within fovea or not, which indicates something is being looked.</span>
<span class="sd">                      In total 30 degrees where human can recognize an object. So we need to divide by 2 \n</span>
<span class="sd">                      half right and half left</span>

<span class="sd">        Parameters  : gaze direction (float or int) : gaze direction which is in degree \n</span>
<span class="sd">                      If we refer to pandas dataframe, it is related to either one of these columns</span>

<span class="sd">                        - GazeDirectionRight(X)Degree</span>
<span class="sd">                        - GazeDirectionRight(Y)Degree</span>

<span class="sd">                        - GazeDirectionLeft(X)Degree</span>
<span class="sd">                        - GazeDirectionLeft(Y)Degree</span>

<span class="sd">        Output (int) :  1 = within the area of fovea (30 degrees) and</span>
<span class="sd">                        0 = NOT within area of fovea</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">within_or_not_fovea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span><span class="n">gaze_direction</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">within_or_not_fovea</span>

    <span class="k">def</span> <span class="nf">looking_percentage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">odd_dataframe</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">even_dataframe</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">srate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">125</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Count how many times each pair &quot;really&quot; looks at each other throughout the experiment</span>
<span class="sd">                    This will look at per second.  &quot;Really&quot; is determined by a previous research which indicates</span>
<span class="sd">                    that humans are conscious look at each other within 100ms,</span>
<span class="sd">                    which is equal to there are 13 times of &quot;looking&quot; value within column of FoveaOdd or FoveaEven</span>

<span class="sd">        Parameters : - odd_dataframe (pandas dataframe) :  dataframe of odd participant</span>
<span class="sd">                    - even_dataframe (pandas dataframe) :  dataframe of even participant</span>
<span class="sd">                    - srate (int) : which indicates the step / per second that we will check whether</span>
<span class="sd">                                    the pair looking or not</span>
<span class="sd">                    - threshold (int) : threshold to determine whether the pair &quot;really&quot; looks or not</span>
<span class="sd">                                        if there are at least 13 times of &quot;looking&quot; within a second (srate)</span>
<span class="sd">                                        under the column of FoveaOdd or FoveaEven, then it is considered &quot;really&quot; looking</span>
<span class="sd">                        Note : Kindly refer to this research to see the threshold of 30 (100ms)</span>
<span class="sd">                        https://journals.sagepub.com/doi/abs/10.1111/j.1467-9280.2006.01750.x?casa_token=AYU81Dg2DAMAAAAA%3Asy9nVGA6NjQPFuRthQW5eCZl9V06TpqV2OgtYbUFPwVKCV4so2PlVJrBWo01EfiSX-yNHul7mX_DlYk&amp;journalCode=pssa</span>

<span class="sd">        Output      : - percent_look (float) : percentage of looking of a pair throughout the experiment</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srate</span> <span class="o">=</span> <span class="mi">125</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mi">13</span>
        <span class="n">percent_look</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">looking</span><span class="o">.</span><span class="n">looking_percentage</span><span class="p">(</span>
            <span class="n">odd_dataframe</span><span class="p">,</span> <span class="n">even_dataframe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">srate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">percent_look</span>


<span class="c1"># %% [markdown]</span>
<span class="c1"># ## High-level module class of EyeAnalysis</span>

<span class="c1"># %%</span>
<div class="viewcode-block" id="EyeAnalysis"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.EyeAnalysis">[docs]</a><span class="k">class</span> <span class="nc">EyeAnalysis</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    High-level module</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span> <span class="o">=</span> <span class="n">_IntermediaryEye</span><span class="p">()</span>

<div class="viewcode-block" id="EyeAnalysis.eye_data_analysis"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.EyeAnalysis.eye_data_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">eye_data_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path2files</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Analyze all cleaned eye tracker data, eg. averted_pre.</span>
<span class="sd">                     It also involves pre-processing (replacing missing values with average value of columns</span>
<span class="sd">                     where they are). It calculates how much each pair looks at each other \n</span>
<span class="sd">                     throughout the experiment(each eye condition)</span>

<span class="sd">        Parameters : - path2files (str): Path to a directory where all cleaned eye tracker files are stored</span>
<span class="sd">                     - tag (str): eye gaze condition, ie. averted_pre, averted_post, direct_pre, direct_post, natural_pre, natural_post</span>

<span class="sd">        Output:      - looking_percentage_all_pairs (list) : Each element represents the percentage  \n</span>
<span class="sd">                                                            of looking of each pair throughout the experiment</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">gaze_keyword</span> <span class="o">=</span> <span class="s2">&quot;/*&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;*.csv&quot;</span>
        <span class="n">pre_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path2files</span> <span class="o">+</span> <span class="n">gaze_keyword</span><span class="p">)</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[S]+(\d+)\-&quot;</span><span class="p">)</span>
        <span class="n">files_pre_odd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files_pre_even</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">looking_percentage_all_pairs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pre_files</span><span class="p">):</span>

            <span class="c1"># Put into a list for ODD subjects - Refer to filename</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">files_pre_odd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

            <span class="c1"># Put into different list for EVEN subjects - Refer to filename</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">files_pre_even</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1">############################################### Odd subject ###############################################</span>
        <span class="c1"># Combine all pre odd files</span>

        <span class="k">with</span> <span class="n">alive_bar</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">files_pre_odd</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Eye Data(&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">force_tty</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">bar</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files_pre_odd</span><span class="p">):</span>

                <span class="n">df_odd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Replace missing values with averages of columns where they are</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_odd</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Remove space before column names</span>
                <span class="n">df_odd_new_columns</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_odd_new_columns</span>

                <span class="c1"># convert cartesian to degree of eye data</span>

                <span class="c1"># Gaze direction (right eye)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Gaze direction (left eye)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># check degree_within_fovea or not</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Compare values of in_fovea for both x-axis and y-axis whether both of them are 1 (odd subjects)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># Change 1 =&gt; look , 0 =&gt; not look (odd subjects)</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;look&quot;</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;not look&quot;</span>

                <span class="c1">############################################### Even subject ###############################################</span>
                <span class="c1"># Combine all pre even files</span>
                <span class="n">df_even</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">files_pre_even</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Replace missing values with averages of columns where they are</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_even</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Remove space before column names</span>
                <span class="n">df_even_new_columns</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_even_new_columns</span>

                <span class="c1"># convert cartesian to degree of eye data</span>

                <span class="c1"># Gaze direction (right eye)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Gaze direction (left eye)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># check degree_within_fovea or not</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Compare values of in_fovea for both x-axis and y-axis whether both of them are 1 (even subjects)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># Change 1 =&gt; look , 0 =&gt; not look (even subjects)</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;look&quot;</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;not look&quot;</span>

                <span class="c1"># Calculate how many times they &quot;really&quot; look at each other</span>
                <span class="n">looking_percentage_each_pair</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">looking_percentage</span><span class="p">(</span><span class="n">df_odd</span><span class="p">,</span> <span class="n">df_even</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Put the percentage of looking each other of each pair into one list</span>
                <span class="n">looking_percentage_all_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">looking_percentage_each_pair</span><span class="p">)</span>

                <span class="n">indicator</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">end_info</span> <span class="o">=</span> <span class="s2">&quot;Pair-&quot;</span> <span class="o">+</span> <span class="n">indicator</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot; is done&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">end_info</span><span class="p">)</span>
                <span class="n">bar</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">looking_percentage_all_pairs</span></div>

<div class="viewcode-block" id="EyeAnalysis.diff_look_percent_pre_post"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.EyeAnalysis.diff_look_percent_pre_post">[docs]</a>    <span class="k">def</span> <span class="nf">diff_look_percent_pre_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">looking_percentage_all_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Find difference of looking percentage between pre and post for three different eye conditions (averted, direct, and natural)</span>

<span class="sd">        Parameters :</span>
<span class="sd">                     - looking_percentage_all_pairs (list): Percentage of &quot;really&quot; looking at each other for all pairs for all eye conditions (both pre and post)</span>
<span class="sd">                        It is the output of eye_data_analysis function</span>

<span class="sd">        Outputs     :</span>
<span class="sd">                      Percentage of looking that has been deducted between pre and post for three different eye conditions:</span>

<span class="sd">                      diff_averted_eye,</span>
<span class="sd">                      diff_direct_eye,</span>
<span class="sd">                      diff_natural_eye</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">diff_averted_eye</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">looking_percentage_all_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">looking_percentage_all_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">diff_direct_eye</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">looking_percentage_all_pairs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">looking_percentage_all_pairs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">diff_natural_eye</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">looking_percentage_all_pairs</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">looking_percentage_all_pairs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">diff_averted_eye</span><span class="p">,</span> <span class="n">diff_direct_eye</span><span class="p">,</span> <span class="n">diff_natural_eye</span></div>

<div class="viewcode-block" id="EyeAnalysis.combine_eye_data"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.EyeAnalysis.combine_eye_data">[docs]</a>    <span class="k">def</span> <span class="nf">combine_eye_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path2files</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Combine all cleaned eye tracker data for each eye condition, eg. averted_pre, into one dataframe.</span>
<span class="sd">                    It also involves pre-processing (replacing missing values with average value of columns</span>
<span class="sd">                    where they are). It calculates how much each pair looks at each other \n</span>
<span class="sd">                    throughout the experiment(each eye condition)</span>

<span class="sd">        Parameters : - path2files (str): Path to a directory where all cleaned eye tracker files are stored</span>
<span class="sd">                    - tag (str): eye gaze condition, ie. averted_pre, averted_post, direct_pre, direct_post, natural_pre, natural_post</span>

<span class="sd">        Output:</span>
<span class="sd">                    - combined_odd_df (dataframe)  : Combined dataframe of odd subjects (1, 3, 5 ..)</span>
<span class="sd">                    - combined_even_df (dataframe) : Combined dataframe of even subjects (2, 4, 6 ..)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">gaze_keyword</span> <span class="o">=</span> <span class="s2">&quot;/*&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;*.csv&quot;</span>
        <span class="n">pre_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path2files</span> <span class="o">+</span> <span class="n">gaze_keyword</span><span class="p">)</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[S]+(\d+)\-&quot;</span><span class="p">)</span>
        <span class="n">files_pre_odd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files_pre_even</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Contain all odd dataframes</span>
        <span class="n">odd_total_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Contain all even dataframes</span>
        <span class="n">even_total_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pre_files</span><span class="p">):</span>

            <span class="c1"># Put into a list for ODD subjects - Refer to filename</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">files_pre_odd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

            <span class="c1"># Put into different list for EVEN subjects - Refer to filename</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">files_pre_even</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1">############################################### Odd subject ###############################################</span>
        <span class="c1"># Combine all pre odd files</span>

        <span class="k">with</span> <span class="n">alive_bar</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">files_pre_odd</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Eye Data(&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">force_tty</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">bar</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files_pre_odd</span><span class="p">):</span>

                <span class="n">df_odd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Replace missing values with averages of columns where they are</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_odd</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Remove space before column names</span>
                <span class="n">df_odd_new_columns</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_odd_new_columns</span>

                <span class="c1"># convert cartesian to degree of eye data</span>

                <span class="c1"># Gaze direction (right eye)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Gaze direction (left eye)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># check degree_within_fovea or not</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_odd</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Compare values of in_fovea for both x-axis and y-axis whether both of them are 1 (odd subjects)</span>
                <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># Change 1 =&gt; look , 0 =&gt; not look (odd subjects)</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;look&quot;</span>
                <span class="n">df_odd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_odd</span><span class="p">[</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;FoveaOdd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;not look&quot;</span>

                <span class="c1"># Populate all odd dataframes into a list</span>
                <span class="n">odd_total_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_odd</span><span class="p">)</span>

                <span class="c1">############################################### Even subject ###############################################</span>
                <span class="c1"># Combine all pre even files</span>
                <span class="n">df_even</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">files_pre_even</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Replace missing values with averages of columns where they are</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_even</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Remove space before column names</span>
                <span class="n">df_even_new_columns</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_even_new_columns</span>

                <span class="c1"># convert cartesian to degree of eye data</span>

                <span class="c1"># Gaze direction (right eye)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Gaze direction (left eye)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_x_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">convert_gaze_direction_in_y_axis_to_degree</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Z)&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># check degree_within_fovea or not</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_even</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intermediaryEye</span><span class="o">.</span><span class="n">check_degree_within_fovea</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)Degree&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Compare values of in_fovea for both x-axis and y-axis whether both of them are 1 (even subjects)</span>
                <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionRight(Y)inFovea&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(Y)inFovea&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># Change 1 =&gt; look , 0 =&gt; not look (even subjects)</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;look&quot;</span>
                <span class="n">df_even</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_even</span><span class="p">[</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;FoveaEven&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;not look&quot;</span>

                <span class="c1"># Populate all even dataframes into a list</span>
                <span class="n">even_total_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_even</span><span class="p">)</span>

                <span class="n">indicator</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">end_info</span> <span class="o">=</span> <span class="s2">&quot;Pair-&quot;</span> <span class="o">+</span> <span class="n">indicator</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot; is done&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">end_info</span><span class="p">)</span>
                <span class="n">bar</span><span class="p">()</span>

            <span class="c1"># Combine all odd dataframes into a single dataframe</span>
            <span class="n">combined_odd_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">odd_total_list</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Combine all even dataframes into a single dataframe</span>
            <span class="n">combined_even_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">even_total_list</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">combined_odd_df</span><span class="p">,</span> <span class="n">combined_even_df</span></div>

<div class="viewcode-block" id="EyeAnalysis.plot_heatmap"><a class="viewcode-back" href="../../eye_tracker.html#eye_tracker.analysis.EyeAnalysis.plot_heatmap">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_heatmap</span><span class="p">(</span>
        <span class="n">df_pre_odd</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">df_pre_even</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">df_post_odd</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">df_post_even</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">save_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">path2savefigure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
    <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objective  : Plot heatmap of gaze direction for a particular eye condition, i.e., averted, direct, and natural</span>

<span class="sd">        Parameters :</span>
<span class="sd">                    - df_pre_odd (DataFrame): Combined dataframe of pre training of odd subjects</span>
<span class="sd">                    - df_pre_even (DataFrame): Combined dataframe of pre training of even subjects</span>
<span class="sd">                    - df_post_odd (DataFrame): Combined dataframe of post training of odd subjects</span>
<span class="sd">                    - df_post_even (DataFrame): Combined dataframe of post training of even subjects</span>
<span class="sd">                                        NOTE : the above inputs (combined dataframe)</span>
<span class="sd">                                               is the output of combine_eye_data function</span>

<span class="sd">                    - tag (str) : Choose one of the options below. MUST be the exact word below :</span>
<span class="sd">                                    &quot;averted&quot;, &quot;direct&quot;, &quot;natural&quot;</span>
<span class="sd">                    - save_fig (boolean)=False (opt) : Option to save the figure. Default is not saving</span>
<span class="sd">                    - path2savefigure (str)=os.getcwd() (opt) : Set path to save the figure. Default is current working directory</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">odd_tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_pre&quot;</span>
        <span class="n">even_tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_post&quot;</span>

        <span class="c1"># Prepare the data so that ready to be plotted</span>

        <span class="c1"># Change FoveaEven to Fovea and FoveaOdd to Fovea (Pre-training)</span>
        <span class="n">df_pre_odd</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">:</span> <span class="s2">&quot;Fovea&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_pre_even</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">:</span> <span class="s2">&quot;Fovea&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Change FoveaEven to Fovea and FoveaOdd to Fovea (Post-training)</span>
        <span class="n">df_post_odd</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;FoveaOdd&quot;</span><span class="p">:</span> <span class="s2">&quot;Fovea&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_post_even</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;FoveaEven&quot;</span><span class="p">:</span> <span class="s2">&quot;Fovea&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Combine dataframe odd and even (Pre-training)</span>
        <span class="n">df_combined_averted_pre</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_pre_odd</span><span class="p">,</span> <span class="n">df_pre_even</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Combine dataframe odd and even (Post-training)</span>
        <span class="n">df_combined_averted_post</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_post_odd</span><span class="p">,</span> <span class="n">df_post_even</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Combine dataframe of Pre and Post-training</span>
        <span class="n">df_combined_averted_pre_post</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_combined_averted_pre</span><span class="p">,</span> <span class="n">df_combined_averted_post</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Round off columns of GazeDirectionRight column</span>
        <span class="n">df_combined_averted_pre_post</span> <span class="o">=</span> <span class="n">df_combined_averted_pre_post</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;GazeDirectionLeft(X)&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Take only Gaze direction for both right and left eye</span>
        <span class="n">df_combined_pre_post_right</span> <span class="o">=</span> <span class="n">df_combined_averted_pre_post</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">,</span> <span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">df_combined_pre_post_left</span> <span class="o">=</span> <span class="n">df_combined_averted_pre_post</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;GazeDirectionLeft(X)&quot;</span><span class="p">,</span> <span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># Rename the columns of left eye to be similar to right eye so that we can combine</span>
        <span class="n">df_combined_pre_post_left</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GazeDirectionLeft(X)&quot;</span><span class="p">:</span> <span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df_combined_pre_post_left</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GazeDirectionLeft(Y)&quot;</span><span class="p">:</span> <span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Combine both right and left eye gaze directions into one dataframe (stacking each other - vertically)</span>
        <span class="n">df_combined_averted_pre_post_gaze_only</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_combined_pre_post_right</span><span class="p">,</span> <span class="n">df_combined_pre_post_left</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Group multiple columns and reset the index</span>
        <span class="n">df_group</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_combined_averted_pre_post_gaze_only</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">,</span> <span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Count how many data that are under the same coordinate or spot</span>
        <span class="n">pivot</span> <span class="o">=</span> <span class="n">df_group</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s2">&quot;GazeDirectionRight(X)&quot;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;GazeDirectionRight(Y)&quot;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Convert dataframe to numpy array</span>
        <span class="n">pivot_array</span> <span class="o">=</span> <span class="n">pivot</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="c1"># Plot the data with background picture</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">winter</span><span class="o">.</span><span class="n">_segmentdata</span>  <span class="c1"># only has r,g,b</span>
        <span class="n">wd</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="c1"># modified colormap with changing alpha</span>
        <span class="n">al_winter</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s2">&quot;AlphaWinter&quot;</span><span class="p">,</span> <span class="n">wd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;averted&quot;</span><span class="p">:</span>
            <span class="c1"># get the overlay IMAGE as an array so we can plot it</span>
            <span class="n">map_img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;figures/averted2plot.png&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;direct&quot;</span><span class="p">:</span>
            <span class="c1"># get the overlay IMAGE as an array so we can plot it</span>
            <span class="n">map_img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;figures/direct2plot.png&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;natural&quot;</span><span class="p">:</span>
            <span class="c1"># get the overlay IMAGE as an array so we can plot it</span>
            <span class="n">map_img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;figures/natural2plot.png&quot;</span><span class="p">)</span>

        <span class="c1"># making and plotting heatmap</span>

        <span class="n">colormap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># This is where we plot the data</span>
        <span class="n">hmax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
            <span class="n">pivot_array</span><span class="p">,</span>
            <span class="c1"># cmap = al_winter, # this worked but I didn&#39;t like it</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.48</span><span class="p">,</span>  <span class="c1"># whole heatmap is translucent</span>
            <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Gaze-Direction Intensity&quot;</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># heatmap uses pcolormesh instead of imshow, so we can&#39;t pass through</span>
        <span class="c1"># extent as a kwarg, so we can&#39;t mmatch the heatmap to the map. Instead,</span>
        <span class="c1"># match the map to the heatmap:</span>

        <span class="c1"># This is where we put the background picture</span>
        <span class="n">hmax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">map_img</span><span class="p">,</span>
            <span class="n">aspect</span><span class="o">=</span><span class="n">hmax</span><span class="o">.</span><span class="n">get_aspect</span><span class="p">(),</span>
            <span class="n">extent</span><span class="o">=</span><span class="n">hmax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span> <span class="o">+</span> <span class="n">hmax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># put the map under the heatmap</span>

        <span class="c1"># Make Capital the first letter of the tag</span>
        <span class="n">tag_title</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="c1"># Combine as title of the figure</span>
        <span class="n">tag_title</span> <span class="o">=</span> <span class="n">tag_title</span> <span class="o">+</span> <span class="s2">&quot;-Eye Gaze Condition&quot;</span>
        <span class="c1"># Put as title</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">tag_title</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Remove x labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[])</span>

        <span class="c1"># Color bar related thing</span>
        <span class="n">c_bar</span> <span class="o">=</span> <span class="n">hmax</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
        <span class="n">ticks_number</span> <span class="o">=</span> <span class="p">[</span><span class="n">ticks</span> <span class="k">for</span> <span class="n">ticks</span> <span class="ow">in</span> <span class="n">c_bar</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()]</span>
        <span class="n">c_bar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="n">ticks_number</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ticks_number</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">c_bar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;High&quot;</span><span class="p">])</span>

        <span class="c1"># Save the figures</span>
        <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">hmax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

            <span class="c1"># Save to the current working directory</span>
            <span class="k">if</span> <span class="n">path2savefigure</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">():</span>
                <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                <span class="c1"># os.chdir(cwd)</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;_eye.png&quot;</span>
                <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

            <span class="c1"># Save to the desired path as mentioned in the parameter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cwd</span> <span class="o">=</span> <span class="n">path2savefigure</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;_eye.png&quot;</span>
                <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Ihshan Gumilar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>